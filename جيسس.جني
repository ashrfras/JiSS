ئورد رجكس؛
ئورد الكل ك نف من ئساسية.خلفي.نف؛
ئورد الكل ك ئتيلة من ئتيلات؛
ئورد الكل ك ئجرائية من ئساسية.خلفي.ئجرائية؛
ئورد الكل ك مسار من ئساسية.خلفي.نف.مسار؛

ئعلن جيسس ():
	يملك نصية جيسخام،
		نوعبنية جيسنتيجة؛
		
	هدا.جيسنتيجة = {
		فوق: ''،
		وسط: ''،
		تحت: ''
	}؛
تم

ئعلن جيسس.حممل () ك وعد فارغ:
	هدا.جيسنتيجة = {
		فوق: ''،
		وسط: ''،
		تحت: ''
	}؛
	ئدا ليس هدا.جيسخام:
		نصية مسارجي = مسار.ئدمج([ئجرائية.ردمجلدتنفيد()، '../جيسس.css'])؛
		هدا.جيسخام = ريتما نف.ئقرئملف(مسارجي)؛
	تم
تم

ئعلن جيسس.ردنتيجة () ك نصية:
	ئرجع هدا.جيسنتيجة.فوق + هدا.جيسنتيجة.وسط + هدا.جيسنتيجة.تحت؛
تم

ئعلن جيسس.موجودقبل (نصية سطر) ك منطق:
	ئرجع (هدا.جيسنتيجة.فوق.يتضمن(سطر) ئو 
			هدا.جيسنتيجة.وسط.يتضمن(سطر) ئو 
			هدا.جيسنتيجة.تحت.يتضمن(سطر)
		)؛
تم


ئعلن جيسس.ئستولد (نصية مصدر، نصية ئسمعنصر؟) ك وعد فارغ:
	ريتما هدا.حممل()؛
	رجكس رج = رجكس ('[\\u0620-\\u064A\\:_][0-9\\u0620-\\u064A_\\:\\-\\.]+'، 'gm')؛
	مصفوفة[] مطابقات = مصدر.طابقكل(رج)؛
	
	لكل مطابق في مطابقات:
		#كل مطابق هو مصفوفة لقيمات المطابقة
		نصية[] كلمقسم = (مطابق[0] ك نصية).قسسم(':')؛
		نصية كلمة = كلمقسم.ئسحب()؛
		منطق هلهام = خطئ؛
		ئدا كلمة == 'هام':
			هلهام = صحيح؛
			كلمة = كلمقسم.ئسحب()؛
		تم
		#هنا المتغير كلمة يتضمن الئسمصنف دون مئترين
		نصية كلمبحت = (كلمة ك نصية).عووض('.'، '\\\\\.')؛
		رجكس رجكسطر = رجكس ("^.*\\._{كلمبحت}[, +].*$"، 'gm')؛ #بحت عام متعدد السطرين	
	
		مصفوفة[] مطابقاسطر = هدا.جيسخام.طابقكل(رجكسطر)؛
		لكل مطابقسطر في مطابقاسطر:
			نصية سطر = (مطابقسطر[0] ك نصية)؛
			منطق يبدئبنقطتان = (كلمقسم[0] == '')؛
			نصية سابقة = (ئسمعنصر ئدا يبدئبنقطتان وئلا ئسمعنصر + ' ') ئدا ئسمعنصر وئلا ''؛
			ئدا هلهام:
				سطر = ئتيلة.مئترهام(سطر، كلمة)؛
			تم
			لكل مئتر في كلمقسم.ئعكس():
				# مئترين نقطتان متل صغ:كدا
				ئدا مئتر == 'داكن':
					سطر = ئتيلة.مئترداكن(سطر، سابقة، ئسمعنصر)؛
				وئلا ئدا مئتر == 'تئشير':
					سطر = ئتيلة.مئترتئشير(سطر)؛
				وئلا ئدا (['صج'، 'صغ'، 'مت'، 'كب'، 'كج'، 'كجج']).يتضمن(مئتر):
					سطر = ئتيلة.مئترحجم(مئتر، سطر، سابقة)؛
				وئلا ئدا مئتر == 'قبل':
					سطر = ئتيلة.مئترقبل(سطر)؛
				وئلا ئدا مئتر == 'بعد':
					سطر = ئتيلة.مئتربعد(سطر)؛
				وئلا ئدا مئتر == '':
					سطر = ئتيلة.مئترنقطتان(سطر)؛
				تم
			تم
			ئدا ليس هدا.موجودقبل(سطر):
				ئدا سطر.يتضمن('.تصفير'):
					هدا.جيسنتيجة.فوق = هدا.جيسنتيجة.فوق + سابقة + سطر؛
				وئلا ئدا سطر.يتضمن('media') ئو سطر.يتضمن('.داكن'):
					هدا.جيسنتيجة.تحت = هدا.جيسنتيجة.تحت + سطر؛
				وئلا:
					هدا.جيسنتيجة.وسط = هدا.جيسنتيجة.وسط + سابقة + سطر؛
				تم
			تم
		تم
	تم	
تم

#يستطوف جميع ملفين ضمن المسار المعطا
#ويستولد جيسس لكل واحد منهم
#ويستجمع الحاصل في ملف سيسس
#يضعه في ئصل المسار المعطا
ئعلن مدخل () ك وعد:
	جيسس جيس = جيسس()؛
	# يقرئ الملفين في المسار المعطا
	نصية[] معطيين = ئجرائية.ردمعطيين()؛
	ئدا معطيين.طول <= 2:
		قل 'يرجا تحديد مسار مشروع جني'؛
		ئجرائية.ئخرج()؛
	تم
	نصية مسارمجلد = معطيين[2]؛
	نصية[] ملفين = ريتما نف.ئقرئمجلد(مسار: مسارمجلد، عودي: صحيح)؛
	ملفين = ملفين.رششح(دالة (نصية عنصر): عنصر.ينتهيب('.جني') ئو عنصر.ينتهيب('.html'))؛
	
	#يقرئ نورمليز الدي يكون مطلع النتيجة
	نصية نورمليز = ريتما نف.ئقرئملف(مسار.ئدمج([ئجرائية.ردمجلدتنفيد()، '../نورمليز.css']))؛
	
	# لكل ملف يستدعي جيسس.ئستولد()
	نصية نتيجة = ''؛
	لكل ئسملف في ملفين:
		نصية مساري = مسار.ئدمج([مسارمجلد، ئسملف])؛
		نصية محتواه = ريتما نف.ئقرئملف(مساري)؛
		ريتما جيس.ئستولد(محتواه)؛
		# يكتب النتيجة في ملف ستايل
		نصية مكتوب = "/*_{ئسملف}*/\n_{جيس.ردنتيجة()}\n"؛
		نتيجة = نتيجة + مكتوب؛
	تم
	
	#يضيف نورمليز مطلع النتيجة
	نتيجة = نورمليز + نتيجة؛
	ريتما نف.ئكتبملف(مسار.ئدمج([مسارمجلد، 'style.css'])، نتيجة، 'كش')؛
تم

